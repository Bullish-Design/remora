from __future__ import annotations

from pathlib import Path
import os
from typing import Any


def _workspace_root() -> Path:
    workspace = os.getenv("REMORA_WORKSPACE_DIR") or os.getenv("CAIRN_WORKSPACE_DIR")
    return Path(workspace) if workspace else Path.cwd()


def _relative_path(path: Path) -> str:
    workspace_root = _workspace_root()
    try:
        return str(path.relative_to(workspace_root))
    except ValueError:
        return str(path)


def run(_: dict[str, Any] | None = None) -> list[dict[str, str]]:
    try:
        fixtures_dir = _workspace_root() / "fixtures"
        if not fixtures_dir.exists() or not fixtures_dir.is_dir():
            return []
        fixtures = []
        for path in sorted(fixtures_dir.iterdir()):
            if path.is_file():
                fixtures.append({"name": path.name, "path": _relative_path(path)})
        return fixtures
    except Exception:
        return []


if __name__ == "__main__":
    print(run())
